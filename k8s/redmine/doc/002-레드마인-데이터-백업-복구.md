# 클러스터간 데이터를 백업하여 복구하는 것을 기술한다

## 복구할 데이터를 찾는다

    kubectl -n redmine get pvc
    NAME                    STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS     AGE
    rm-app-files-pvc        Bound    pvc-ca079b64-c2fa-4d2d-a2d8-73ac954c6c5e   20Gi       RWX            gluster-heketi   39m
    rm-app-pvc              Bound    pvc-897021f2-0a8a-4e51-b89f-efade84a6bdb   20Gi       RWX            gluster-heketi   39m
    rm-postgresql-app-pvc   Bound    pvc-b0883b0b-2c0f-43bb-9fd7-6f7b72a61555   10Gi       RWX            gluster-heketi   39m

    복구할 데이터는 

        rm-app-files-pvc
        rm-app-pvc
        rm-postgresql-app-pvc
    
    이다.

        rm-posgresql-app-pvc 는 rm-app-pvc를 복구를 하면 따로 할 필요가 없다.

rm-app-files-pvc
rm-app-pvc
## rm-app-pvc 데이터 백업

    해당 클러스터의 로드벨런스로 접속한다.

        ssh www.falinux.dev
    
    glusterfs 로 마운트 한다.

        sudo mount -t glusterfs 192.168.10.xx:vol_xx backup

    데이터를 가져올 로드벨러스에 접속한다.
    글러스터파일시스템으로 마운드한다.
    데이터를 백업한다.
    tar zcfv redmine-files.tar.gz redmine/brick/redmine/*

    복구할 클러스터로 압축 파일을 전송한다.

## 복구할 클러스터에서의 작업 

    복구할 클러스터의 로드벨런스로 접속한다.
    복구할 서비스의 글러스터로 마운트 한다.

    마운트 백업한 데이터를 복원한다.

    tar zxfv redmine-files.tar.gz --strip-components=2 -C /bitnami/

---

erp2 렌처 접근하여

```
tar zxfv redmine-files.tar.gz --strip-components=1 -C /bitnami/
```
